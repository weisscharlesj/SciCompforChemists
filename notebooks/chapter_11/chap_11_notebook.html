
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 11: Nuclear Magnetic Resonance with nmrglue and nmrsim &#8212; Scientific Computing for Chemists with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/chapter_11/chap_11_notebook';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Chapter 12: Machine Learning using Scikit-Learn" href="../chapter_12/chap_12_notebook.html" />
    <link rel="prev" title="Chapter 10: Plotting with Seaborn" href="../chapter_10/chap_10_notebook.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../introduction/intro.html">
  
  
  
  
  
    
    
    
    <img src="../../_static/logo.svg" class="logo__image only-light" alt="Scientific Computing for Chemists with Python - Home"/>
    <img src="../../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="Scientific Computing for Chemists with Python - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../introduction/intro.html">
                    Scientific Computing for Chemists with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Scientific Computing Skills</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter_00/chap_00_notebook.html">Chapter 0: Python &amp; Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_01/chap_01_notebook.html">Chapter 1: Basic Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_02/chap_02_notebook.html">Chapter 2: Intermediate Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_03/chap_03_notebook.html">Chapter 3: Plotting with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_04/chap_04_notebook.html">Chapter 4: NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_05/chap_05_notebook.html">Chapter 5: Pandas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Topics &amp; Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../chapter_06/chap_06_notebook.html">Chapter 6: Signal &amp; Noise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_07/chap_07_notebook.html">Chapter 7: Image Processing &amp; Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_08/chap_08_notebook.html">Chapter 8: Mathematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_09/chap_09_notebook.html">Chapter 9: Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_10/chap_10_notebook.html">Chapter 10: Plotting with Seaborn</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 11: Nuclear Magnetic Resonance with nmrglue and nmrsim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_12/chap_12_notebook.html">Chapter 12: Machine Learning using Scikit-Learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_13/chap_13_notebook.html">Chapter 13: Command Line &amp; Spyder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_14/chap_14_notebook.html">Chapter 14: Optimization and Root Finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_15/chap_15_notebook.html">Chapter 15: Cheminformatics with RDKit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter_16/chap_16_notebook.html">Chapter 16: Bioinformatics with Biopython and Nglview</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../appendix_00/appendix_00_notebook.html">Appendix 0: Ipython Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix_01/appendix_01_notebook.html">Appendix 1: Remote Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix_02/appendix_02_notebook.html">Appendix 2: Visualizing Atomic Orbitals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/weisscharlesj/SciCompforChemists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/weisscharlesj/SciCompforChemists/issues/new?title=Issue%20on%20page%20%2Fnotebooks/chapter_11/chap_11_notebook.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/chapter_11/chap_11_notebook.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 11: Nuclear Magnetic Resonance with nmrglue and nmrsim</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nmr-processing-with-nmrglue">11.1 NMR Processing with nmrglue</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-data-with-nmrglue">11.1.1 Importing Data with nmrglue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-transforming-data">11.1.2 Fourier Transforming Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phasing-data">11.1.3 Phasing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autophasing">11.1.3.1 Autophasing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-phasing">11.1.3.2 Manual Phasing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-shift">11.1.4 Chemical Shift</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-the-x-axis">11.1.4.1 Generate the X-Axis</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#referencing-the-data">11.1.4.2 Referencing the Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration">11.1.5 Integration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-picking">11.1.6 Peak Picking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-nmr-with-nmrsim">11.2 Simulating NMR with nmrsim</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-first-order-multiplets">11.2.1 Simulating First-Order Multiplets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-spectra">11.2.2 Simulating Spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-second-order-resonances">11.2.3 Simulate Second-Order Resonances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-nmr-simulations">11.2.4 Dynamic NMR Simulations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-11-nuclear-magnetic-resonance-with-nmrglue-and-nmrsim">
<span id="id1"></span><h1>Chapter 11: Nuclear Magnetic Resonance with nmrglue and nmrsim<a class="headerlink" href="#chapter-11-nuclear-magnetic-resonance-with-nmrglue-and-nmrsim" title="Link to this heading">#</a></h1>
<div class="cell tag_remove-input docutils container">
</div>
<p>Nuclear magnetic resonance (NMR) spectroscopy is one of the most common and powerful analytical methods used in modern chemistry. Up to this point, we having been primarily dealing with text-based data files - that is, files that can be opened with a text editor and still contain human comprehendible information. If you open most files that come out of an NMR instrument in a text editor, it will look more like gibberish than anything a human should be able to read. This is because they are <em>binary</em> files - they are written in computer language rather than human language.</p>
<p>We need a specialized module to be able to import and read these data, and luckily a Python library called nmrglue to does exactly this. The library contains modules for dealing with data from each of the major NMR spectroscopy file types which includes Bruker, Pipe, Sparky, and Varian. It does not read JEOL files, but as of this writing, JEOL spectrometers support exporting data into at least one of the above file types supported by nmrglue and direct support for JEOL files is under development.</p>
<p>In addition, it is also sometimes helpful to be able to simulate NMR spectra to confirm spectral parameters (e.g., coupling constants), visualize hypothetical spectra of splitting patterns, or fit the line shapes or splitting patterns of experimental data. The library nmrsim provides the ability to simulate NMR spectra including dynamic NMR and is introduced in <a class="reference internal" href="#id13"><span class="std std-ref">section 11.2</span></a>.</p>
<section id="nmr-processing-with-nmrglue">
<span id="id2"></span><h2>11.1 NMR Processing with nmrglue<a class="headerlink" href="#nmr-processing-with-nmrglue" title="Link to this heading">#</a></h2>
<p id="index-0">Currently, nmrglue is not included with default installation of Anaconda, so you will need to install it. Instructions are included on the <a class="reference external" href="https://nmrglue.readthedocs.io/en/latest/index.html">nmrglue documentation page</a> or you can use <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install it. If Jupyterlab is installed on your computer, you should be able to install it through the terminal using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nmrglue</span></code>, and if you are using Google Colab, you should include <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">nmrglue</span></code> in the first code cell of the notebook (see <a class="reference internal" href="../chapter_00/chap_00_notebook.html#id3"><span class="std std-ref">section 0.2</span></a>). nmrglue requires you have NumPy and SciPy installed, and matplotlib should also be installed for visualization.</p>
<p>All use of code below assumes the following imports with aliases. nmrglue is not a major library in the SciPy ecosystem, so the <code class="docutils literal notranslate"><span class="pre">ng</span></code> alias is not a strong convention but is used here for convenience and to be consistent with the online documentation.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nmrglue</span> <span class="k">as</span> <span class="nn">ng</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>The general procedure for collecting NMR data is to excite a given type of NMR-active nuclei with a radio-frequency pulse and allow them to relax. As they precess, their rotation leads to a voltage oscillation in the instrument at characteristic frequencies, and the spectrometer records these oscillations as a <em>free induction decay (fid)</em> depicted below (Figure 1, left). It is the frequency of these oscillations that we are interested in because they are informative to a trained chemist as to the chemical environment of the nuclei. One challenge is that all the different signals from each of the nuclei are stacked on top of each other making it difficult to distinguish one from the other or to determine the wave frequency. This is similar to the problem of a computer discerning a single instrument in an entire orchestra playing at once. Fortunately, there is a mathematical equation called the Fourier transform that converts the above <em>fid</em> into a graph showing all of the different frequencies (Figure 1, right). This is what is known as converting the <em>time domain</em> to the <em>frequency domain</em>.</p>
<p><img alt="" src="../../_images/fid.svg" /></p>
<p><strong>Figure 1</strong> Raw NMR spectroscopy data is converted from the time domain (left) to the frequency domain (right) using a Fourier transform.</p>
<p>The general steps for dealing with NMR spectroscopic data in Python are outlined below.</p>
<ol class="arabic simple">
<li><p>Load the fid data into a NumPy array using nmrglue</p></li>
<li><p>Fourier transform the data to the frequency domain</p></li>
<li><p>Phase the spectrum</p></li>
<li><p>Reference the spectrum</p></li>
<li><p>Measure the chemical shifts and integrals of the peaks</p></li>
</ol>
<section id="importing-data-with-nmrglue">
<span id="id3"></span><h3>11.1.1 Importing Data with nmrglue<a class="headerlink" href="#importing-data-with-nmrglue" title="Link to this heading">#</a></h3>
<p id="index-1">The importing of data using nmrglue is performed by the read function from one of the submodules shown in Table 1. Additional modules can be found in the <a class="reference external" href="https://nmrglue.readthedocs.io/en/latest/tutorial.html">nmrglue documention</a>. The choice of module is dictated by the data file type.</p>
<p><strong>Table 1</strong> Examples of nmrglue Modules</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Module</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">bruker</span></code></p></td>
<td class="text-left"><p>Bruker data as a single file</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">pipe</span></code></p></td>
<td class="text-left"><p>Pipe data as a single file with an <code class="docutils literal notranslate"><span class="pre">.fid</span></code> extension</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">sparky</span></code></p></td>
<td class="text-left"><p>Sparky NMR file format with <code class="docutils literal notranslate"><span class="pre">.ucsf</span></code> extension</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">varian</span></code></p></td>
<td class="text-left"><p>Varian/Agilent data as a folder of data with an <code class="docutils literal notranslate"><span class="pre">.fid</span></code> extension</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">jcampdx</span></code></p></td>
<td class="text-left"><p>JCAMP-DX files with .dx or <code class="docutils literal notranslate"><span class="pre">.jdx</span></code> extensions</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">read()</span></code> function loads the NMR file and returns a tuple containing a dictionary of metadata and data in a NumPy array. The dictionary includes information required to complete the processing of the NMR data. Looking at the NMR data shown below, you may have noticed each point includes both both real and imaginary components (i.e., the mathematical terms with <code class="docutils literal notranslate"><span class="pre">j</span></code>). Both are necessary for phasing the spectrum later on, so don’t discard any of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dic</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;data/EtPh_1H_NMR_CDCl3.fid&#39;</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.00194889-0.00471539j, -0.00192186-0.00472489j,
       -0.00191337-0.00473085j, ..., -0.00189737+0.00591656j,
       -0.00191882+0.005872j  , -0.00191135+0.00587132j],
      shape=(13107,), dtype=complex64)
</pre></div>
</div>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The data used in this demo was already Fourier transformed on the spectrometer, so the following cell reverses this process for demo purposed. Some spectrometers automatically Fourier transform the data while others do not.</p>
</div>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reversed the Fourier transform for demo purposes being as this data </span>
<span class="c1"># was colleced on a spectrometer that already Fourier transformed the data.</span>

<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">ifft</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">data</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The dictionary, <code class="docutils literal notranslate"><span class="pre">dic</span></code>, above contains a very long list of values, and the dictionary keys can be different among different file formats. To maintain a shorter, more useful, and more consistent dictionary of metadata, nmrglue provides the <code class="docutils literal notranslate"><span class="pre">guess_udic()</span></code> function for generating a <em>universal dictionary</em> among all file formats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">udic</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">guess_udic</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">udic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ndim&#39;: 1,
 0: {&#39;sw&#39;: 5994.65478515625,
  &#39;complex&#39;: True,
  &#39;obs&#39;: 399.7821960449219,
  &#39;car&#39;: 1998.9109802246094,
  &#39;size&#39;: 13107,
  &#39;label&#39;: &#39;Proton&#39;,
  &#39;encoding&#39;: &#39;direct&#39;,
  &#39;time&#39;: False,
  &#39;freq&#39;: True}}
</pre></div>
</div>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In NMR spectroscopy, “1D NMR” is actually two-dimensional while “2D NMR” are actually three-dimensional.</p>
</div>
</aside>
<p>The universal dictionary is a nested dictionary. The first key is <code class="docutils literal notranslate"><span class="pre">ndim</span></code> which provides the number of dimensions in the NMR spectrum. Most NMR spectra are one dimensional, but two dimensional is also fairly common. Subsequent key(s) are for each dimension in the NMR spectrum with the value as a nested dictionary of metadata. Because the data for the above spectrum is one-dimensional, there is only one nested dictionary. Table 2 below provides a description of each piece of metadata contained in the universal dictionary.</p>
<p><strong>Table 2</strong> <code class="docutils literal notranslate"><span class="pre">udic</span></code> Dictionary Keys for Single Dimensions*</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Key</p></th>
<th class="head text-left"><p>Description</p></th>
<th class="head text-left"><p>Data Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">car</span></code></p></td>
<td class="text-left"><p>Carrier frequency (Hz)</p></td>
<td class="text-left"><p>Float</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">complex</span></code></p></td>
<td class="text-left"><p>Indicates if the data contain complex values</p></td>
<td class="text-left"><p>Boolean</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code></p></td>
<td class="text-left"><p>Encoding format</p></td>
<td class="text-left"><p>String</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">freq</span></code></p></td>
<td class="text-left"><p>Indicates if the data are in the frequency domain</p></td>
<td class="text-left"><p>Boolean</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">label</span></code></p></td>
<td class="text-left"><p>Observed nucleus</p></td>
<td class="text-left"><p>String</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">obs</span></code></p></td>
<td class="text-left"><p>Observed frequency (MHz)</p></td>
<td class="text-left"><p>Float</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td class="text-left"><p>Number of data points in spectrum</p></td>
<td class="text-left"><p>Integer</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">sw</span></code></p></td>
<td class="text-left"><p>Spectral width (Hz)</p></td>
<td class="text-left"><p>Float</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td class="text-left"><p>Indicates if the data are in the time domain**</p></td>
<td class="text-left"><p>Boolean</p></td>
</tr>
</tbody>
</table>
</div>
<p>* That is, it is assumed that we are looking at single dimensions from the NMR data, so for example, we are looking at <code class="docutils literal notranslate"><span class="pre">udic[0]</span></code>.</p>
<p>** Being that the data must be in either the frequency or time domain, the <code class="docutils literal notranslate"><span class="pre">freq</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span></code> keywords effectively provide the same information.</p>
</section>
<section id="fourier-transforming-data">
<span id="id4"></span><h3>11.1.2 Fourier Transforming Data<a class="headerlink" href="#fourier-transforming-data" title="Link to this heading">#</a></h3>
<p id="index-2">When the data is first imported, it is often in the time domain. You can confirm this by checking that the <code class="docutils literal notranslate"><span class="pre">time</span></code> value in the <code class="docutils literal notranslate"><span class="pre">udic</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> like below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">udic</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We can also view the data by plotting with matplotlib.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax0</span> <span class="o">=</span> <span class="n">fig0</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">real</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2fcb2054adb4737ebcb38248d129858a5bb5cea732684127802ff073be1d819d.svg" src="../../_images/2fcb2054adb4737ebcb38248d129858a5bb5cea732684127802ff073be1d819d.svg" />
</div>
</div>
<p>To convert the data to the frequency domain, we will use the fast Fourier transform function (<code class="docutils literal notranslate"><span class="pre">fft</span></code>) from the <code class="docutils literal notranslate"><span class="pre">fft</span></code> SciPy module. nmrglue also contains Fourier transform functions, but we will use SciPy here. The plot below inverts the <em>x</em>-axis with <code class="docutils literal notranslate"><span class="pre">plt.gca().invert_xaxis()</span></code> to conform to NMR plotting convensions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span>
<span class="n">fdata</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span> <span class="c1"># reverses direction of x-axis to conform to NMR plotting norms</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/49e6cff327e9e90faab8724b53f8bb8b70d6bac24d87839cc0c2052f259b1609.svg" src="../../_images/49e6cff327e9e90faab8724b53f8bb8b70d6bac24d87839cc0c2052f259b1609.svg" />
</div>
</div>
<p>When you plot the Fourier transformed data, you may get a <code class="docutils literal notranslate"><span class="pre">ComplexWarning</span></code> error message because the Fourier transform will return complex values (i.e., values with real and imaginary components). To only work with the real components, use the <code class="docutils literal notranslate"><span class="pre">.real</span></code> method as is done above. The plot now looks more like an NMR spectrum, but most of the resonances are out of phase. The next step is to phase the spectrum.</p>
</section>
<section id="phasing-data">
<span id="id5"></span><h3>11.1.3 Phasing Data<a class="headerlink" href="#phasing-data" title="Link to this heading">#</a></h3>
<p>Phasing is the post-processing procedure for making all peaks point upward as shown in Figure 2. There is more to it than taking the absolute value as that would not always generate a single peak, so nmrglue contains a series of functions for phasing spectra.</p>
<p><img alt="" src="../../_images/phasing.svg" /></p>
<p><strong>Figure 2</strong> Phasing an NMR spectrum results in all the signals pointing in the positive direction.</p>
<section id="autophasing">
<span id="id6"></span><h4>11.1.3.1 Autophasing<a class="headerlink" href="#autophasing" title="Link to this heading">#</a></h4>
<p>The simplest method to phase your NMR spectrum is to allow the autophasing function to handle it for you. Below is the function which takes the data and the phasing algorithm as the arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ng</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">proc_autophase</span><span class="o">.</span><span class="n">autops</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">)</span>
</pre></div>
</div>
<p>The permitted phasing algorithms can be either <code class="docutils literal notranslate"><span class="pre">acme</span></code> or <code class="docutils literal notranslate"><span class="pre">peak_minima</span></code>. It is important to feed the <code class="docutils literal notranslate"><span class="pre">autops()</span></code> function the data array with <em>both</em> the real and imaginary components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phased_data</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">proc_autophase</span><span class="o">.</span><span class="n">autops</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span> <span class="s1">&#39;acme&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: 0.001729
         Iterations: 117
         Function evaluations: 236
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phased_data</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/79cda81b9f7fc76229559eade9baa32edff60f13828aecc9e9ca7dcc97866d36.svg" src="../../_images/79cda81b9f7fc76229559eade9baa32edff60f13828aecc9e9ca7dcc97866d36.svg" />
</div>
</div>
<p>You should try both algorithms to see which works best for you. The above spectrum is the result of the <code class="docutils literal notranslate"><span class="pre">acme</span></code> autophasing algorithm which is close but still slightly off. If neither of the provided autophasing algorithms work for you, you will need to instead manually phase the NMR spectrum as discussed below.</p>
</section>
<section id="manual-phasing">
<span id="id7"></span><h4>11.1.3.2 Manual Phasing<a class="headerlink" href="#manual-phasing" title="Link to this heading">#</a></h4>
<p>Manually phasing the NMR spectrum is a two-step process. First, you need to call the <code class="docutils literal notranslate"><span class="pre">manual_ps()</span></code> phasing function and adjust the <code class="docutils literal notranslate"><span class="pre">p0</span></code> and <code class="docutils literal notranslate"><span class="pre">p1</span></code> sliders until the spectrum appears phased.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span>  <span class="c1"># exists inline plotting</span>
<span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">proc_autophase</span><span class="o">.</span><span class="n">manual_ps</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/manual_phaseing_window.png" /></p>
<p>After closing the window, the function will return values for <code class="docutils literal notranslate"><span class="pre">p0</span></code> and <code class="docutils literal notranslate"><span class="pre">p1</span></code> that you found to properly phase the spectrum. Second, input those <code class="docutils literal notranslate"><span class="pre">p0</span></code> and <code class="docutils literal notranslate"><span class="pre">p1</span></code> values into the <code class="docutils literal notranslate"><span class="pre">ps()</span></code> phasing function to actually phase the spectrum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phased_data</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">proc_base</span><span class="o">.</span><span class="n">ps</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>  <span class="c1"># reinstates inline plotting</span>

<span class="n">fig3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig3</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phased_data</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
</pre></div>
</div>
<p>You can then plot the <code class="docutils literal notranslate"><span class="pre">phased_data</span></code> to get your NMR spectrum with all the peaks pointing upward.</p>
</section>
</section>
<section id="chemical-shift">
<span id="id8"></span><h3>11.1.4 Chemical Shift<a class="headerlink" href="#chemical-shift" title="Link to this heading">#</a></h3>
<p>Even though the NMR spectrum is now phased, it is unlikely to be properly <em>referenced</em>. That is, the peaks are not currently located at the correct <em>chemical shift</em>. Referencing is often performed by knowing the accepted chemical shifts of the solvent resonances or an internal standard (e.g., tetramethylsilane, TMS) and adjusting the spectrum by a correction factor. Currently, we are plotting our data against the index of each data point, so first we need to create a frequency scaled <em>x</em>-axis as an array followed by adjusting the location of the spectrum so that it is properly referenced.</p>
<section id="generate-the-x-axis">
<span id="id9"></span><h4>11.1.4.1 Generate the X-Axis<a class="headerlink" href="#generate-the-x-axis" title="Link to this heading">#</a></h4>
<p>The <em>x</em>-axis is the frequency scale, so this axis is sometimes presented in hertz (Hz). However, because the frequency of NMR resonances depends upon the instrument field strength, the same sample will exhibit different frequencies in different instruments. To make the frequency axis independent of the spectrometer field strength, NMR spectra are often presented on a <em>ppm scale</em> which is the ratio of the observed chemical shift (Hz) versus a standard over the spectrometer frequency (MHz) at which that particular nucleus is observed.</p>
<div class="math notranslate nohighlight">
\[ ppm = \frac{Observed \, Frequency \, (Hz)}{Spectrometer \, Frequency \, (MHz)} \]</div>
<p>This makes the locations of the peaks consistent from spectrometer to spectrometer no matter the strength of the magnet. This is where the <code class="docutils literal notranslate"><span class="pre">udic</span></code> from <a class="reference internal" href="#id3"><span class="std std-ref">section 11.1.1</span></a> is important because we can obtained the observed frequency width (Hz) of the spectrum, and the resolution of the data. The latter is how many data points are in the spectrum which is important so that we avoid a plotting error (we all know the one: <code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">x</span> <span class="pre">and</span> <span class="pre">y</span> <span class="pre">must</span> <span class="pre">have</span> <span class="pre">same</span> <span class="pre">first</span> <span class="pre">dimension,...</span></code>). If any of the values from the <code class="docutils literal notranslate"><span class="pre">udic</span></code> are 999.99, this means the spectrometer did not record this piece of information and you will need to find it elsewhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="n">udic</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="c1"># points in data</span>
<span class="n">sw</span> <span class="o">=</span> <span class="n">udic</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sw&#39;</span><span class="p">]</span>     <span class="c1"># width in Hz</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">udic</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>   <span class="c1"># carrier frequency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="n">hz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="n">sw</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span> <span class="c1"># x-axis in Hz </span>
<span class="n">ppm</span> <span class="o">=</span> <span class="n">hz</span> <span class="o">/</span> <span class="n">obs</span>                       <span class="c1"># x-axis in ppm</span>
</pre></div>
</div>
</div>
</div>
<p>Now if we plot the spectrum, we see it in a ppm scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig4</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm</span><span class="p">,</span> <span class="n">phased_data</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5bb2b12192c7741c792f8ea472b6651d3d5d459f9865fdd6726c2639913ca58d.svg" src="../../_images/5bb2b12192c7741c792f8ea472b6651d3d5d459f9865fdd6726c2639913ca58d.svg" />
</div>
</div>
<p>Alternatively, nmrglue contains an object called a <em>unit conversion object</em> that can be created and used to convert between ppm, Hz, and point index values for any position in an NMR spectrum. To create a unit conversion object, use the <code class="docutils literal notranslate"><span class="pre">make_uc()</span></code> function which takes two arguments  – the dictionary, <code class="docutils literal notranslate"><span class="pre">dic</span></code>, and the original data array, <code class="docutils literal notranslate"><span class="pre">data</span></code>, generated from reading the NMR file in section 11.2.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using a different NMR file format than pipe, change <code class="docutils literal notranslate"><span class="pre">pipe</span></code> to the appropriate format from Table 1.</p>
</div>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">unit_conv</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">make_uc</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>   

<span class="n">ppm</span> <span class="o">=</span> <span class="n">unit_conv</span><span class="o">.</span><span class="n">ppm_scale</span><span class="p">()</span>
</pre></div>
</div>
<p>The last line of the above code generates an array of ppm values required for the <em>x</em>-axis to plot the NMR data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uc</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">make_uc</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">ppm_scale</span> <span class="o">=</span> <span class="n">uc</span><span class="o">.</span><span class="n">ppm_scale</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phased_data_rev</span> <span class="o">=</span> <span class="n">phased_data</span><span class="o">.</span><span class="n">real</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig5</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">,</span> <span class="n">phased_data_rev</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/18921c2323c0e8a825848283f4df81330cc0dceccf586ca1bef2464e2dc2144e.svg" src="../../_images/18921c2323c0e8a825848283f4df81330cc0dceccf586ca1bef2464e2dc2144e.svg" />
</div>
</div>
<p>The following example uses the ppm scale generated by the unit conversion object.</p>
</section>
<section id="referencing-the-data">
<span id="id10"></span><h4>11.1.4.2 Referencing the Data<a class="headerlink" href="#referencing-the-data" title="Link to this heading">#</a></h4>
<p>In the above spectrum, the small resonance at 0.08 ppm is internal TMS (tetramethylsilane) standard which should be located at 0.00 ppm. The temptation is to subtract 0.08 ppm from the x-axis, but the spectrum is not simply moved over but instead is rolled. That is, as the spectrum is moved, some of it disappears off one end and reappears on the other (Figure 3).</p>
<p><img alt="" src="../../_images/rolling.svg" /></p>
<p><strong>Figure 3</strong> Referencing an NMR spectrum is performing by rolling it until the peaks reside at the correct shifts. As a signal falls of one end of the spectrum, it reappears at the other end.</p>
<p>Conveniently for us, NumPy has a function <code class="docutils literal notranslate"><span class="pre">np.roll()</span></code> that does exactly this to array data, and nmrglue contains its own <code class="docutils literal notranslate"><span class="pre">ng.process.proc_base.roll()</span></code> function for this task which calls the NumPy function. Feel free to use either one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">np.roll()</span></code> function takes two required arguments. The first is the array containing the data and the second is the amount to shift or roll the data. The shift is not in ppm but rather positions in the data array. If you know your referencing correction in ppm (Δppm), use the following equation which describes the relationship between the correction in ppm (Δppm) and the correction in number of data points (Δpoints). The <code class="docutils literal notranslate"><span class="pre">size</span></code> is the number of point in a spectrum, <code class="docutils literal notranslate"><span class="pre">obs</span></code> is the observed carrier frequency, and <code class="docutils literal notranslate"><span class="pre">sw</span></code> is the sweep width in Hz. These values are all available from the universal dictionary.</p>
<div class="math notranslate nohighlight">
\[ \Delta_{points} = \frac{\Delta_{ppm} \times size \times obs}{sw}  \]</div>
<p>Alternatively, you can accomplisht this same calculation using the unit conversion object by determing the data point difference between 0.00 ppm and the current position of the TMS. The example below requires the spectrum to be shifted by -0.08 ppm, and both approaches are demonstrated below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_shift_manual</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">0.08</span> <span class="o">*</span> <span class="n">size</span> <span class="o">*</span> <span class="n">obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">sw</span><span class="p">)</span> <span class="c1"># calc shift yourself</span>
<span class="c1"># OR</span>
<span class="n">ref_shift_uc</span> <span class="o">=</span> <span class="n">uc</span><span class="p">(</span><span class="s1">&#39;0.00 ppm&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">uc</span><span class="p">(</span><span class="s1">&#39;0.08 ppm&#39;</span><span class="p">)</span> <span class="c1"># calc shift using unit conversion object</span>

<span class="n">data_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">phased_data_rev</span><span class="p">,</span> <span class="n">ref_shift_uc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax6</span> <span class="o">=</span> <span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">,</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fa77c3c293ec2974aa17d5ee922bb4c28c221f36b471fa71f3b22cda79fd34d1.svg" src="../../_images/fa77c3c293ec2974aa17d5ee922bb4c28c221f36b471fa71f3b22cda79fd34d1.svg" />
</div>
</div>
<p>If you want to narrow the plot to where the resonances are located, you can use the <code class="docutils literal notranslate"><span class="pre">plt.xlim(8,0)</span></code> function. Notice that 8 is first to indicate that the plot is from 8 ppm <span class="math notranslate nohighlight">\(\rightarrow\)</span> 0 ppm. The use of <code class="docutils literal notranslate"><span class="pre">plt.xlim(8,0)</span></code> removes the need to use <code class="docutils literal notranslate"><span class="pre">plt.gca().invert_xaxis()</span></code> to flip the <em>x</em>-axis.</p>
</section>
</section>
<section id="integration">
<span id="id11"></span><h3>11.1.5 Integration<a class="headerlink" href="#integration" title="Link to this heading">#</a></h3>
<p>Integration of the area under the peaks can be performed using either integration functions from the <code class="docutils literal notranslate"><span class="pre">scipy.integrate</span></code> module or though nmrglue’s integration function(s). Because the integration function in nmrglue supports limit values in the ppm scale, it is probably the most convenient and is demonstrated below.</p>
<p>The integration is performed using the <code class="docutils literal notranslate"><span class="pre">integrate()</span></code> function below where <code class="docutils literal notranslate"><span class="pre">data</span></code> is your NMR data as a NumPy array, the <code class="docutils literal notranslate"><span class="pre">conv_obj</span></code> is an nmrglue unit conversion object (see <a class="reference internal" href="#id9"><span class="std std-ref">section 11.1.4.1</span></a>), and limits is a list or array of limits for integration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ng</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">integration</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">conv_obj</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uc</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">pipe</span><span class="o">.</span><span class="n">make_uc</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">phased_data_rev</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">7.07</span><span class="p">,</span><span class="mf">7.37</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.10</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.50</span><span class="p">,</span><span class="mf">2.75</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig7</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax7</span> <span class="o">=</span> <span class="n">fig7</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">,</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">ax7</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">limits</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lim</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e55973bc41b55c4129ede64d6c0f150b3128d33c501047086e3490c91142de5b.svg" src="../../_images/e55973bc41b55c4129ede64d6c0f150b3128d33c501047086e3490c91142de5b.svg" />
</div>
</div>
<p>The limits are in ppm, so take a look at the spectrum above and decide where you want to put the integration limits. An NMR spectrum with the chosen integration limits are shown above as vertical red lines.</p>
<p>Now to integrate our NMR spectrum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">area</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">integration</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">uc</span><span class="p">,</span> <span class="n">limits</span><span class="p">)</span>
<span class="n">area</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.05381569, 0.03379756, 0.02178194])
</pre></div>
</div>
</div>
</div>
<p>These values are probably not what you expected, but if we divide all of them by the smallest value, it is easier to see the relative ratio of areas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratio</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
<span class="n">ratio</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2.47065636, 1.55163197, 1.        ])
</pre></div>
</div>
</div>
</div>
<p>The spectrum above is the <span class="math notranslate nohighlight">\(^1\)</span>H NMR of ethylbenzene in CDCl<span class="math notranslate nohighlight">\(_3\)</span> which has five aromatic protons, and the other two resonances should have three and two protons. If we do some math to make the integrations total to ten protons and round to the nearest integer, we get 5:3:2. There is a small amount of error likely due to the solvent resonance (CHCl<span class="math notranslate nohighlight">\(_3\)</span>, 7.27 ppm) being included in the integration of the aromatic protons among other things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">ratio</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([4.91938374, 3.08949203, 1.99112423])
</pre></div>
</div>
</div>
</div>
</section>
<section id="peak-picking">
<span id="id12"></span><h3>11.1.6 Peak Picking<a class="headerlink" href="#peak-picking" title="Link to this heading">#</a></h3>
<p>Another piece of information that is commonly extracted from NMR spectra is the chemical shift of the resonances. Similar to integration, SciPy contains functions such as <a class="reference internal" href="../chapter_06/chap_06_notebook.html#id4"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">scipy.signal.argrelmax()</span></code></span></a> or <a class="reference internal" href="../chapter_06/chap_06_notebook.html#id5"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">scipy.signal.find_peaks()</span></code></span></a> that can find peaks in spectra, but again, nmrglue contains a function, below, designed for the task of locating peaks in NMR spectra.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ng</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">peakpick</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pthres</span><span class="o">=</span><span class="p">)</span>
</pre></div>
</div>
<p>There are numerous optional arguments for the peak picking function, but the two mandatory pieces of information required are the <code class="docutils literal notranslate"><span class="pre">data</span></code> array and a positive threshold (<code class="docutils literal notranslate"><span class="pre">pthres=</span></code>) above which any peak will be identified. Glancing at the spectrum below, all peaks are above 0.1 (green dotted line) and the baseline is below 0.1, so this seems like a reasonable threshold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig8</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax8</span> <span class="o">=</span> <span class="n">fig8</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax8</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">,</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">ax8</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d7f38604b238ff5bb028feb445f81b42c49820528b4c7af0e006eebb0686f5f9.svg" src="../../_images/d7f38604b238ff5bb028feb445f81b42c49820528b4c7af0e006eebb0686f5f9.svg" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ng.analysis.peakpick.pick()</span></code> does not work with NumPy versions 1.24 and later if you are using a version of nmrglue before 0.10. Consider upgrading your version of nmrglue if <code class="docutils literal notranslate"><span class="pre">ng.analysis.peakpick.pick()</span></code> raises an error.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peaks</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">peakpick</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">pthres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rec.array([(4568., 1, 32.13860124, 17.82116699),
           (4648., 2, 35.96968658, 25.60328484),
           (8591., 3,  5.        ,  0.88379395),
           (8624., 4, 31.36229043, 16.87084198),
           (9846., 5, 34.1857674 , 27.6301403 )],
          dtype=[(&#39;X_AXIS&#39;, &#39;&lt;f8&#39;), (&#39;cID&#39;, &#39;&lt;i8&#39;), (&#39;X_LW&#39;, &#39;&lt;f8&#39;), (&#39;VOL&#39;, &#39;&lt;f8&#39;)])
</pre></div>
</div>
</div>
</div>
<p>The output of this function is an array of tuples with each tuple containing information about an identified peak. From this, we can already tell there are four peaks identified. Each tuple contains an index for the peak, a peak number, a line width of the peak, and an estimate of the areas of each peak. We can use the index values to index the <code class="docutils literal notranslate"><span class="pre">ppm</span></code> array for the chemical shifts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peak_loc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
    <span class="n">peak_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">peak_loc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[np.float64(7.270899450723067), np.float64(7.17937704723959), np.float64(2.6684665855476872), np.float64(2.6307135941107536), np.float64(1.232708880900633)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig9</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax9</span> <span class="o">=</span> <span class="n">fig9</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax9</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm_scale</span><span class="p">,</span> <span class="n">data_ref</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">ax9</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">peak_loc</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/373f8054e7ac3411995652e9aafb3b8a7fc25a18a5cfcd34196bc3d65c361ec5.svg" src="../../_images/373f8054e7ac3411995652e9aafb3b8a7fc25a18a5cfcd34196bc3d65c361ec5.svg" />
</div>
</div>
<p>We can plot the NMR spectrum with these chemical shifts marked with vertical dotted lines shown above. Looks like it did a pretty good job locating the resonances! If nmrglue fails to properly identify the peaks, there are a number of parameters described in the <a class="reference external" href="https://nmrglue.readthedocs.io/en/latest/reference/generated/nmrglue.analysis.peakpick.pick.html#nmrglue.analysis.peakpick.pick">nmrglue documentation</a> that can be adjusted.</p>
</section>
</section>
<section id="simulating-nmr-with-nmrsim">
<span id="id13"></span><h2>11.2 Simulating NMR with nmrsim<a class="headerlink" href="#simulating-nmr-with-nmrsim" title="Link to this heading">#</a></h2>
<p>nmrsim is a Python package for simulating NMR spectra based on information such as the chemical shifts, coupling constants, and number of coupling nuclei. The package is capable of simulating individual first-order and second-order splitting patterns or enitre NMR spectra. It can also simulate dynamic NMR caused by nuclei rapidly exchanging. nmrsim is <a class="reference external" href="https://nmrsim.readthedocs.io/en/latest/installation.html">installable using <code class="docutils literal notranslate"><span class="pre">pip</span></code></a>. The package has a few key functions listed below (Table 3) for simulating first-order multiples, spin systems, and spectra. The <code class="docutils literal notranslate"><span class="pre">Multiplet()</span></code> function is used to simulate a single, first-order resonance such as a 1:2:1 triplet or a doublet-of-doublets while the <code class="docutils literal notranslate"><span class="pre">SpinSystem()</span></code> function simulates two resonance signals belonging to pairs of coupled nuclei. The <code class="docutils literal notranslate"><span class="pre">Spectrum()</span></code> function can generate entire spectra by merging the resonances generated by other functions.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>nmrsim is still in beta, so significant changes to the library may occur in future updates.</p>
</div>
</aside>
<p><strong>Table 3</strong> Select nmrsim Simulation Functions</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Function</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">Multiplet()</span></code></p></td>
<td class="text-left"><p>Simulates a single, first-order multiple</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">SpinSystem()</span></code></p></td>
<td class="text-left"><p>Simulates sets of first- or second-order multiplets generated by coupled nuclei</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">Spectrum()</span></code></p></td>
<td class="text-left"><p>Simulates first-order spectra</p></td>
</tr>
</tbody>
</table>
</div>
<section id="simulating-first-order-multiplets">
<span id="id14"></span><h3>11.2.1 Simulating First-Order Multiplets<a class="headerlink" href="#simulating-first-order-multiplets" title="Link to this heading">#</a></h3>
<p>As an example, we can simulate a the signal of methylene (i.e., -CH<span class="math notranslate nohighlight">\(_2\)</span>-) protons in CH<span class="math notranslate nohighlight">\(_3\)</span>-CH<span class="math notranslate nohighlight">\(_2\)</span>-CH-. Let us assume that the methyl/methylene protons have coupling constants of <em>J</em> = 7.8 Hz the methine/methylene protons have a coupling constant of <em>J</em> = 6.1 Hz. First, we need to import the <code class="docutils literal notranslate"><span class="pre">Multiplet()</span></code> function along with the <code class="docutils literal notranslate"><span class="pre">mplplot()</span></code> plotting function. The <code class="docutils literal notranslate"><span class="pre">Multiplet()</span></code> fuction takes the resonance frequency in Hz (<code class="docutils literal notranslate"><span class="pre">v</span></code>) as the first positional argument followed by the intensity (<code class="docutils literal notranslate"><span class="pre">I</span></code>) of the resonance signal. This can simply be the number of nuclei the signal represents and is only really important when generating entire spectra with multiple signals so that signals that represent more nuclei have a larger area. Finally, coupling constants(<code class="docutils literal notranslate"><span class="pre">J</span></code>)/number of nuclei (<code class="docutils literal notranslate"><span class="pre">n_nuc</span></code>) pairs is provided as a list of tuples, list of lists, or 2D array.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Multiplet</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="p">[(</span><span class="n">J</span><span class="p">,</span> <span class="n">n_nuc</span><span class="p">),</span> <span class="p">(</span><span class="n">J</span><span class="p">,</span> <span class="n">n_nuc</span><span class="p">)])</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Multiplet()</span></code> function generates a Multiplet object which can produce a peak list using the <code class="docutils literal notranslate"><span class="pre">peaklist()</span></code> method. The peak list is simply a list of tuples with (<code class="docutils literal notranslate"><span class="pre">v</span></code>, <code class="docutils literal notranslate"><span class="pre">I</span></code>) pairs for each peak in the multiplet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmrsim</span> <span class="kn">import</span> <span class="n">Multiplet</span>
<span class="kn">from</span> <span class="nn">nmrsim.plt</span> <span class="kn">import</span> <span class="n">mplplot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mult</span> <span class="o">=</span> <span class="n">Multiplet</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[(</span><span class="mf">7.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),(</span><span class="mf">6.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
<span class="n">mult</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;nmrsim._classes.Multiplet at 0x12855ff20&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mult_peaks</span> <span class="o">=</span> <span class="n">mult</span><span class="o">.</span><span class="n">peaklist</span><span class="p">()</span>
<span class="n">mult_peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(485.25000000000006, 0.125),
 (491.3500000000001, 0.125),
 (493.05, 0.375),
 (499.15000000000003, 0.375),
 (500.84999999999997, 0.375),
 (506.95, 0.375),
 (508.6499999999999, 0.125),
 (514.7499999999999, 0.125)]
</pre></div>
</div>
</div>
</div>
<p>Next we need to visualize this data. For this, nmrsim provides multiple plotting functions built off of matplotlib. We will focus on the <code class="docutils literal notranslate"><span class="pre">mplplot()</span></code> function which accepts the peaklist and generates the line shapes for the actual peaks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mplplot</span><span class="p">(</span><span class="n">peaklist</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">),</span> <span class="n">points</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span> 
</pre></div>
</div>
<p>There are a number of optional, keyword arguments such as line width (<code class="docutils literal notranslate"><span class="pre">w</span></code>), <em>y</em>-axis limits (<code class="docutils literal notranslate"><span class="pre">y_min</span></code> and <code class="docutils literal notranslate"><span class="pre">y_max</span></code>), <em>x</em>-axis limits (<code class="docutils literal notranslate"><span class="pre">limits</span></code>), and number of points in the multiplet (<code class="docutils literal notranslate"><span class="pre">points</span></code>). The <code class="docutils literal notranslate"><span class="pre">mplplot()</span></code> function will return the <em>x-</em> and <em>y</em>-coordinates for the plot. To suppres this, either end the line with a <code class="docutils literal notranslate"><span class="pre">;</span></code> or give it a pair of variables to store these data.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the splitting pattern does not look quite right, consider increasing the number of points because undersampling can lead to anomalous looking signals.</p>
</div>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq</span><span class="p">,</span> <span class="n">intens</span> <span class="o">=</span> <span class="n">mplplot</span><span class="p">(</span><span class="n">mult_peaks</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x128c00fe0&gt;]
</pre></div>
</div>
<img alt="../../_images/28093e9baae5af146d658a26d710435e62a589ca3d7c708564771650d12fe86e.svg" src="../../_images/28093e9baae5af146d658a26d710435e62a589ca3d7c708564771650d12fe86e.svg" />
</div>
</div>
<p>Below is the same splitting pattern with the line width tripled.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mplplot</span><span class="p">(</span><span class="n">mult_peaks</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x128c5e180&gt;]
</pre></div>
</div>
<img alt="../../_images/46b41c9e342eec492bc1019eb9759347822bc97f09522ffb0892ad244aa43d58.svg" src="../../_images/46b41c9e342eec492bc1019eb9759347822bc97f09522ffb0892ad244aa43d58.svg" />
</div>
</div>
<p>As another option, we can overlay the multiplet with lines showing the exact chemical shift and intensity ratio of each peak. This can be done either using your plotting library of choice or using the <code class="docutils literal notranslate"><span class="pre">mplplot_stick()</span></code> function in nmrsim. Below the intensity of the stem plot is reduced by a fifth to keep the lines inside the blue splitting pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mult_peaks</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">intens</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">peaks</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;StemContainer object of 3 artists&gt;
</pre></div>
</div>
<img alt="../../_images/3ebfee6cb5e33387cf1ccc0d3ef1f2a00004533f4219a9dda873f0f4af0ea538.svg" src="../../_images/3ebfee6cb5e33387cf1ccc0d3ef1f2a00004533f4219a9dda873f0f4af0ea538.svg" />
</div>
</div>
</section>
<section id="simulating-spectra">
<span id="id15"></span><h3>11.2.2 Simulating Spectra<a class="headerlink" href="#simulating-spectra" title="Link to this heading">#</a></h3>
<p>Entire NMR spectra can be simulated from the component resonance signals -  either Multiplet or SpinSystem objects. Down below, we simulate the signals for the methyl, ethyl, and -OH from ethanol with a <em>J</em>=7.3 Hz. Because the -OH peak is broader due to exhange, the width of the resonance is increased by setting <code class="docutils literal notranslate"><span class="pre">w=3</span></code>. The three resonances are then combined into a single spectrum using the <code class="docutils literal notranslate"><span class="pre">Spectrum()</span></code> function which accepts the resonances in a list and also optionally accepts minimum (<code class="docutils literal notranslate"><span class="pre">vmin=</span></code>) and maximum (<code class="docutils literal notranslate"><span class="pre">vmax</span></code>) frequency ranges for the spectrum in Hz.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A spectrum can also be created by adding the resonance signals together with the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator like below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spec</span> <span class="o">=</span> <span class="n">methyl</span> <span class="o">+</span> <span class="n">ethyl</span> <span class="o">+</span> <span class="n">OH</span>
</pre></div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmrsim</span> <span class="kn">import</span> <span class="n">Spectrum</span>

<span class="c1"># create resonances</span>
<span class="n">methyl</span> <span class="o">=</span> <span class="n">Multiplet</span><span class="p">(</span><span class="mi">492</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[(</span><span class="mf">7.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="n">ethyl</span> <span class="o">=</span> <span class="n">Multiplet</span><span class="p">(</span><span class="mi">1480</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[(</span><span class="mf">7.3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="n">OH</span> <span class="o">=</span> <span class="n">Multiplet</span><span class="p">(</span><span class="mi">1020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[],</span> <span class="n">w</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># build spectrum</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">([</span><span class="n">methyl</span><span class="p">,</span> <span class="n">ethyl</span><span class="p">,</span> <span class="n">OH</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1600</span><span class="p">)</span>
<span class="n">v_spec</span><span class="p">,</span> <span class="n">I_spec</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">lineshape</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>

<span class="c1"># convert from Hz to ppm scale on a 400 MHz spectrometer</span>
<span class="n">v_spec_ppm</span> <span class="o">=</span> <span class="n">v_spec</span> <span class="o">/</span> <span class="mi">400</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v_spec_ppm</span><span class="p">,</span> <span class="n">I_spec</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Chemical Shift, ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/137ee7c4a31c291fe1f1a43b4d03fdfee31f01a8162487374a9d097afde0e6d1.svg" src="../../_images/137ee7c4a31c291fe1f1a43b4d03fdfee31f01a8162487374a9d097afde0e6d1.svg" />
</div>
</div>
<p>The simulation even exhibits the second-order roofing effect where coupled resonances ‘lean’ towards each other.</p>
</section>
<section id="simulate-second-order-resonances">
<span id="id16"></span><h3>11.2.3 Simulate Second-Order Resonances<a class="headerlink" href="#simulate-second-order-resonances" title="Link to this heading">#</a></h3>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SpinSystem()</span></code> function can also simulate second-order signals with a default setting of <code class="docutils literal notranslate"><span class="pre">second_order=False</span></code>.</p>
</div>
</aside>
<p>nmrsim is capable of simulating second-order splitting patterns using the following functions (Table 4). The name of each function is based on the Pople nomation where letters adjacent to each other in the alphabet represent resonances that are near each other in a spectrum (e.g., A and B), letters far apart in the alphabet represent resonances further part in the spectrum (e.g., A and X), the same letter is used to represent chemically equivalent nuclei, and primes are used to differentiate chemical equivalent nuclei that are magnetically inequivalent (e.g., A and A’).</p>
<p><strong>Table 4</strong> Second-Order Simulation Functions</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Function</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">AB()</span></code></p></td>
<td class="text-left"><p>Simulates an AB system</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">AB2()</span></code></p></td>
<td class="text-left"><p>Simulates an AB<span class="math notranslate nohighlight">\(_2\)</span> system</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">ABX()</span></code></p></td>
<td class="text-left"><p>Simulates an ABX system</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">ABX3()</span></code></p></td>
<td class="text-left"><p>Simulates an ABX<span class="math notranslate nohighlight">\(_3\)</span> system</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">AAXX()</span></code></p></td>
<td class="text-left"><p>Simulates an AA’XX’ system</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p><code class="docutils literal notranslate"><span class="pre">AABB()</span></code></p></td>
<td class="text-left"><p>Simulates an AA’BB’ system</p></td>
</tr>
</tbody>
</table>
</div>
<p>These functions typically accept the coupling constants (e.g., <code class="docutils literal notranslate"><span class="pre">Jab=</span></code>), the distance between the two nuclei (e.g., <code class="docutils literal notranslate"><span class="pre">Vab=</span></code>), and the chemical shift of the signal in Hz (<code class="docutils literal notranslate"><span class="pre">Vcentr=</span></code>). As a demonstration, below we will simulate an AB spin system where the two nuclei are coupled with <em>J</em>=10.0 Hz and separation between the two signals of 9.0 Hz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmrsim.discrete</span> <span class="kn">import</span> <span class="n">AB</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">AB</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1918</span><span class="p">)</span>
<span class="n">mplplot</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x128ff0080&gt;]
</pre></div>
</div>
<img alt="../../_images/f83f80202e1c8a65273ab15e1b4b8b22f601771090f93c3a36f4d8a3c2cbef78.svg" src="../../_images/f83f80202e1c8a65273ab15e1b4b8b22f601771090f93c3a36f4d8a3c2cbef78.svg" />
</div>
</div>
<p>If we increase the distance between the two nuclei to 30.0 Hz, not only do the two signals become futhure apart, but the second-order character, unevenness in this case, decreases. It is important to note that when measuring the distance between the two second-order signals like this, the center of a doublet with uneven heights is not the center of the doublet but rather a weighted frequency average of the two peaks based on intensities. This means the chemical shift of a doublet is closer to the larger of the two peaks in the doublet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">AB</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1918</span><span class="p">)</span>
<span class="n">mplplot</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D object at 0x128d5cec0&gt;]
</pre></div>
</div>
<img alt="../../_images/e01d1060bc38857adb2ffdbb92744684042da9b6a1b51b7312a0200bff56eba5.svg" src="../../_images/e01d1060bc38857adb2ffdbb92744684042da9b6a1b51b7312a0200bff56eba5.svg" />
</div>
</div>
</section>
<section id="dynamic-nmr-simulations">
<span id="id17"></span><h3>11.2.4 Dynamic NMR Simulations<a class="headerlink" href="#dynamic-nmr-simulations" title="Link to this heading">#</a></h3>
<p>Nuclei in some molecules can exchange with each other at observable rates. At lower temperatures, the exchange is relatively slow leading to two distinct and reasonably sharp signals representing the two environments of the exchaning nuclei. As the temperature is increased, the exchanges becomes more rapid causing the two signals to broaden and become closer until they merge into a single peak and ultimately sharpen. There are two dynamic NMR functions in the nmrsim.dnmr module: the <code class="docutils literal notranslate"><span class="pre">dnmr_two_singlets()</span></code> function which simuluates two exchanging nuclei (or groups of chemically equivalent nuclei) that are not coupling with each other while the <code class="docutils literal notranslate"><span class="pre">dnmr_AB()</span></code> function simulates two exchangin nuclei that couple with each other. Below we will simulate two non-coupled, singlet signals exchaning with either other. The required areguments are the chemical shift frequencies of the two nuclei during slow exchange (<code class="docutils literal notranslate"><span class="pre">va</span></code> and <code class="docutils literal notranslate"><span class="pre">vb</span></code>), the exchange rate constant in Hz (<code class="docutils literal notranslate"><span class="pre">k</span></code>), the half-height width of the peaks at slow exchange (<code class="docutils literal notranslate"><span class="pre">wa</span></code> and <code class="docutils literal notranslate"><span class="pre">wb</span></code>), and the fraction of the nulei in position <em>a</em> (<code class="docutils literal notranslate"><span class="pre">pa</span></code>). Optionally, you can specify the frequency limits for the generated line shape (<code class="docutils literal notranslate"><span class="pre">limits=</span></code>) and number of data point (<code class="docutils literal notranslate"><span class="pre">points=</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">dnmr_two_singlets</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">vb</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">),</span> <span class="n">point</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</pre></div>
</div>
<p>Below is a simulation with a rate constant of 70 Hz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nmrsim.dnmr</span> <span class="kn">import</span> <span class="n">dnmr_two_singlets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">dnmr_two_singlets</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x12903f800&gt;]
</pre></div>
</div>
<img alt="../../_images/50f2f66b18a5e84636c1865b7cfde0e546535ae469b1a16faf3e3d22a6218777.svg" src="../../_images/50f2f66b18a5e84636c1865b7cfde0e546535ae469b1a16faf3e3d22a6218777.svg" />
</div>
</div>
</section>
</section>
<section id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>NMRglue Website. <a class="reference external" href="https://www.nmrglue.com/">https://www.nmrglue.com/</a> (free resource)</p></li>
<li><p>NMRglue Documentation Page. <a class="reference external" href="https://www.nmrglue.com/">http://nmrglue.readthedocs.io/en/latest/tutorial.html</a> (free resource)</p></li>
<li><p>J.J. Helmus, C.P. Jaroniec, Nmrglue: An open source Python package for the analysis of multidimensional NMR data, J. Biomol. NMR 2013, 55, 355-367, <a class="reference external" href="http://dx.doi.org/10.1007/s10858-013-9718-x">http://dx.doi.org/10.1007/s10858-013-9718-x</a>. (paper on nmrglue)</p></li>
<li><p>nmrsim Documentation Page. <a class="reference external" href="https://nmrsim.readthedocs.io/en/latest/introduction.html">https://nmrsim.readthedocs.io/en/latest/introduction.html</a> (free resource)</p></li>
<li><p>American Chemical Society Division of Organic Chemistry, Hans Reich’s NMR Spectroscopy Collection. <a class="reference external" href="https://organicchemistrydata.org/hansreich/resources/nmr/?page=nmr-content%2F">https://organicchemistrydata.org/hansreich/resources/nmr/?page=nmr-content%2F</a> (free resource)</p></li>
</ol>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>Complete the following exercises in a Jupyter notebook and NMRglue library. Any data file(s) refered to in the problems can be found in the <a class="reference external" href="https://github.com/weisscharlesj/SciCompforChemists/tree/master/notebooks">data</a> folder in the same directory as this chapter’s Jupyter notebook. Alternatively, you can download a zip file of the data for this chapter from <a class="reference external" href="https://github.com/weisscharlesj/data_SciCompforChem">here</a> by selecting the appropriate chapter file and then clicking the <strong>Download</strong> button.</p>
<ol class="arabic">
<li><p>Open the <span class="math notranslate nohighlight">\(^1\)</span>H NMR spectrum of ethanol, <strong>EtOH_1H_NMR.fid</strong>, taken in CDCl<span class="math notranslate nohighlight">\(_3\)</span> with TMS using NMRglue. Use the <code class="docutils literal notranslate"><span class="pre">pipe</span></code> module.</p>
<p>a) Plot the resulting spectrum and be sure to properly reference it if not done already.</p>
<p>b) Integrate the methyl (-CH<span class="math notranslate nohighlight">\(_3\)</span>) versus the methylene (-CH<span class="math notranslate nohighlight">\(_2\)</span>-) resonances and calculate the ratio.</p>
</li>
<li><p>Open the <span class="math notranslate nohighlight">\(^1\)</span>H and <span class="math notranslate nohighlight">\(^{13}\)</span>C NMR spectra of 2-ethyl-1-hexanol, <strong>2-ethyl-1-hexanol_1H_NMR_CDCl3.fid</strong> and <strong>2-ethyl-1-hexanol_13C_NMR_CDCl3.fid</strong>, in CDCl<span class="math notranslate nohighlight">\(_3\)</span> with TMS and plot them on a ppm scale. Be sure to properly phase and reference the spectra if not done already. Use the <code class="docutils literal notranslate"><span class="pre">pipe</span></code> module.</p></li>
<li><p>Simulate a first-order doublet of triplets with <em>J</em>=5.6 Hz and <em>J</em>=9.2 Hz, respectively.</p></li>
<li><p>Select an article from the <a class="reference external" href="https://pubs.acs.org/journal/joceah"><em>Journal of Organic Chemistry</em></a> or some other journal and simulate an NMR spectrum with coupling (e.g., not <span class="math notranslate nohighlight">\(^{13}\)</span>C{<span class="math notranslate nohighlight">\(^1\)</span>H}) based on data listed in the experimental section. <em>Note</em>: some articles are free to access even if you do not have a subscription. Just accesss the most recent issue, and the free articles are marked “Open Access” in ACS journals.</p></li>
<li><p>Simulate a second-order AA’BB’ simulation with a <em>J</em><span class="math notranslate nohighlight">\(_{AA'}\)</span> = 15.0 Hz, <em>J</em><span class="math notranslate nohighlight">\(_{BB'}\)</span> = 15.0 Hz, <em>J</em><span class="math notranslate nohighlight">\(_{AB}\)</span> = 7.0 Hz, <em>J</em><span class="math notranslate nohighlight">\(_{AB'}\)</span> = 7.0 Hz and a separation of 27.0 Hz. Compare your simulate to what is shown on <a class="reference external" href="https://organicchemistrydata.org/hansreich/resources/nmr/?page=05-hmr-15-aabb%2F">Hans Reich’s figure</a> (first set of NMR spectra on the page).</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "scicompchem-env"
        },
        kernelOptions: {
            name: "scicompchem-env",
            path: "./notebooks/chapter_11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'scicompchem-env'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../chapter_10/chap_10_notebook.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 10: Plotting with Seaborn</p>
      </div>
    </a>
    <a class="right-next"
       href="../chapter_12/chap_12_notebook.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 12: Machine Learning using Scikit-Learn</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nmr-processing-with-nmrglue">11.1 NMR Processing with nmrglue</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-data-with-nmrglue">11.1.1 Importing Data with nmrglue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-transforming-data">11.1.2 Fourier Transforming Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phasing-data">11.1.3 Phasing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autophasing">11.1.3.1 Autophasing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-phasing">11.1.3.2 Manual Phasing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-shift">11.1.4 Chemical Shift</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-the-x-axis">11.1.4.1 Generate the X-Axis</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#referencing-the-data">11.1.4.2 Referencing the Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration">11.1.5 Integration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-picking">11.1.6 Peak Picking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-nmr-with-nmrsim">11.2 Simulating NMR with nmrsim</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-first-order-multiplets">11.2.1 Simulating First-Order Multiplets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-spectra">11.2.2 Simulating Spectra</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-second-order-resonances">11.2.3 Simulate Second-Order Resonances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-nmr-simulations">11.2.4 Dynamic NMR Simulations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Charles J. Weiss
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2017-2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  Scientific Computing for Chemists with Python is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>